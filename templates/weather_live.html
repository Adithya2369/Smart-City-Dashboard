{% extends "base.html" %}
{% block content %}
  <div class="grid">
    <div class="card col-12">
      <div style="display:flex; align-items:center; justify-content:space-between;">
        <div>
          <h3 style="margin:0; color:var(--accent-1);">Weather â€” Live</h3>
          <div class="tiny">Auto-refreshes every 20 seconds</div>
        </div>
        <div style="display:flex; gap:8px;">
          <a class="btn" href="{{ url_for('weather_history') }}">View History</a>
        </div>
      </div>
    </div>

    {% if not live %}
      <div class="card col-12 empty">No live weather data available.</div>
    {% else %}
      {% set skip_ts = ['Timestamp','Time','timestamp','time'] %}
      {% set items = [] %}
      {% for k, v in live.items() %}
        {% if k not in skip_ts %}
          {% set _ = items.append({'k':k,'v':v}) %}
        {% endif %}
      {% endfor %}

      {% for it in items %}
        <div class="card col-3">
          <div class="stat-title">{{ it.k }}</div>
          <div class="stat-val">{{ it.v }}</div>
          <div class="muted-small">live</div>
        </div>
      {% endfor %}

      <div class="card col-12">
        <div style="display:flex; justify-content:space-between; align-items:center;">
          <div>
            <div class="tiny">Timestamp</div>
            <div style="font-weight:700;">{{ live.get('Timestamp') or live.get('Time') or 'N/A' }}</div>
          </div>
          <div class="tiny">Data source: Google Sheets (Weather)</div>
        </div>
      </div>
    {% endif %}

  </div>
{% endblock %}

{% block scripts %}
<script>
    // Auto refresh every 20 seconds
    setTimeout(function(){
        location.reload();
    }, 20000);
</script>
{% endblock %}
